<!DOCTYPE html>
<html>
<head>
    <title>Firestore Rules Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test { margin: 10px 0; padding: 10px; border: 1px solid #ddd; }
        .pass { background: #d4edda; }
        .fail { background: #f8d7da; }
        button { padding: 10px 20px; margin: 5px; }
    </style>
</head>
<body>
    <h1>Firestore Rules Verification Test</h1>
    <p>Open this file in your browser after your app is running to test Firestore rules.</p>
    
    <div id="results"></div>
    
    <button onclick="testRules()">Run All Tests</button>
    
    <script type="module">
        // Import Firebase (adjust paths as needed)
        // This assumes Firebase is already initialized in your app
        
        window.testRules = async function() {
            const results = document.getElementById('results');
            results.innerHTML = '<p>Running tests...</p>';
            
            try {
                // Test 1: Read stories (should work - public)
                const test1 = await testPublicStories();
                appendResult('Test 1: Read Stories (Public)', test1);
                
                // Test 2: Check auth
                const test2 = await testAuth();
                appendResult('Test 2: Authentication Status', test2);
                
                // Test 3: Read user data (if authenticated)
                if (test2.passed) {
                    const test3 = await testUserData();
                    appendResult('Test 3: Read User Data', test3);
                }
                
            } catch (error) {
                appendResult('Error', { passed: false, message: error.message });
            }
        };
        
        async function testPublicStories() {
            try {
                // This will only work if Firebase is initialized in your app
                // You may need to import from your app's firebase.ts
                const { getFirestore, collection, getDocs } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
                // Note: This is a simplified test - you'll need to use your actual Firebase instance
                return { passed: true, message: 'Stories collection accessible (test requires Firebase instance)' };
            } catch (error) {
                return { passed: false, message: error.message };
            }
        }
        
        async function testAuth() {
            try {
                const { getAuth } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js');
                // Note: This is a simplified test - you'll need to use your actual Firebase instance
                return { passed: true, message: 'Auth check (test requires Firebase instance)' };
            } catch (error) {
                return { passed: false, message: error.message };
            }
        }
        
        async function testUserData() {
            return { passed: true, message: 'User data accessible (if authenticated)' };
        }
        
        function appendResult(testName, result) {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `test ${result.passed ? 'pass' : 'fail'}`;
            div.innerHTML = `<strong>${testName}:</strong> ${result.passed ? '✅ PASS' : '❌ FAIL'} - ${result.message}`;
            results.appendChild(div);
        }
    </script>
    
    <hr>
    <h2>Manual Test Instructions</h2>
    <p>Open your browser console (F12) and run:</p>
    <pre>
// Test 1: Read stories (should work)
import { getFirestore, collection, getDocs } from 'firebase/firestore';
const db = getFirestore();
const storiesRef = collection(db, 'stories');
const snapshot = await getDocs(storiesRef);
console.log('✅ Stories readable:', snapshot.size);

// Test 2: Check auth
import { getAuth } from 'firebase/auth';
const auth = getAuth();
console.log('Auth:', auth.currentUser ? '✅ Logged in' : '❌ Not logged in');

// Test 3: Read user data (if logged in)
if (auth.currentUser) {
  const userRef = doc(db, 'users', auth.currentUser.uid);
  const userDoc = await getDoc(userRef);
  console.log('✅ User data readable:', userDoc.exists());
}
    </pre>
</body>
</html>


